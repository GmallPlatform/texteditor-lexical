"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("./index-CuK9MUGs.cjs"),K=require("./useLexicalNodeSelection.prod-sIqzeWoO.cjs"),s=require("lexical"),m=require("react"),B="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22%203H2v18h20v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h2V3zm-2%204v2h-2v2h2v2h-2v2h2v2h-2v2H4V5h14v2h2zm-6%202h-2v2h-2v2H8v2H6v2h2v-2h2v-2h2v-2h2v2h2v-2h-2V9zM6%207h2v2H6V7z'%20fill='%23000000'/%3e%3c/svg%3e";function A(p,C,d){return Math.min(Math.max(p,C),d)}const r={east:1,north:8,south:2,west:4};function X({onResizeStart:p,onResizeEnd:C,imageRef:d,maxWidth:S,editor:_}){const M=m.useRef(null),N=m.useRef({priority:"",value:"default"}),w=m.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),f=_.getRootElement(),b=S||(f!==null?f.getBoundingClientRect().width-20:100),z=f!==null?f.getBoundingClientRect().height-20:100,D=100,x=100,y=e=>{const i=e===r.east||e===r.west,t=e===r.north||e===r.south,R=e&r.north&&e&r.west||e&r.south&&e&r.east,h=i?"ew":t?"ns":R?"nwse":"nesw";f!==null&&f.style.setProperty("cursor",`${h}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${h}-resize`,"important"),N.current.value=document.body.style.getPropertyValue("-webkit-user-select"),N.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},j=()=>{f!==null&&f.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",N.current.value,N.current.priority))},g=(e,i)=>{if(!_.isEditable())return;const t=d.current,R=M.current;if(t!==null&&R!==null){e.preventDefault();const{width:h,height:v}=t.getBoundingClientRect(),l=n.Lt(t),c=w.current;c.startWidth=h,c.startHeight=v,c.ratio=h/v,c.currentWidth=h,c.currentHeight=v,c.startX=e.clientX/l,c.startY=e.clientY/l,c.isResizing=!0,c.direction=i,y(i),p(),R.classList.add("image-control-wrapper--resizing"),t.style.height=`${v}px`,t.style.width=`${h}px`,document.addEventListener("pointermove",O),document.addEventListener("pointerup",o)}},O=e=>{const i=d.current,t=w.current,R=t.direction&(r.east|r.west),h=t.direction&(r.south|r.north);if(i!==null&&t.isResizing){const v=n.Lt(i);if(R&&h){let l=Math.floor(t.startX-e.clientX/v);l=t.direction&r.east?-l:l;const c=A(t.startWidth+l,D,b),P=c/t.ratio;i.style.width=`${c}px`,i.style.height=`${P}px`,t.currentHeight=P,t.currentWidth=c}else if(h){let l=Math.floor(t.startY-e.clientY/v);l=t.direction&r.south?-l:l;const c=A(t.startHeight+l,x,z);i.style.height=`${c}px`,t.currentHeight=c}else{let l=Math.floor(t.startX-e.clientX/v);l=t.direction&r.east?-l:l;const c=A(t.startWidth+l,D,b);i.style.width=`${c}px`,t.currentWidth=c}}},o=()=>{const e=d.current,i=w.current,t=M.current;if(e!==null&&t!==null&&i.isResizing){const R=i.currentWidth,h=i.currentHeight;i.startWidth=0,i.startHeight=0,i.ratio=0,i.startX=0,i.startY=0,i.currentWidth=0,i.currentHeight=0,i.isResizing=!1,t.classList.remove("image-control-wrapper--resizing"),j(),C(R,h),document.removeEventListener("pointermove",O),document.removeEventListener("pointerup",o)}};return n.jsxRuntimeExports.jsxs("div",{ref:M,children:[n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{g(e,r.north)}}),n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{g(e,r.north|r.east)}}),n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{g(e,r.east)}}),n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{g(e,r.south|r.east)}}),n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{g(e,r.south)}}),n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{g(e,r.south|r.west)}}),n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{g(e,r.west)}}),n.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{g(e,r.north|r.west)}})]})}const H=s.createCommand("RIGHT_CLICK_IMAGE_COMMAND");function q(p){if(!n.imageCache.has(p))throw new Promise(C=>{const d=new Image;d.src=p,d.onload=()=>{n.imageCache.add(p),C(null)},d.onerror=()=>{n.imageCache.add(p)}})}function U({altText:p,className:C,imageRef:d,src:S,width:_,height:M,maxWidth:N,onError:w}){return q(S),n.jsxRuntimeExports.jsx("img",{className:C||void 0,src:S,alt:p,ref:d,style:{height:M,maxWidth:N,width:_},onError:w,draggable:"false"})}function F(){return n.jsxRuntimeExports.jsx("img",{src:B,style:{height:200,opacity:.2,width:200},draggable:"false"})}function J({src:p,altText:C,nodeKey:d,width:S,height:_,maxWidth:M,resizable:N,showCaption:w,caption:f,captionsEnabled:b}){const z=m.useRef(null),D=m.useRef(null),[x,y,j]=K.u(d),[g,O]=m.useState(!1),[o]=n.o(),[e,i]=m.useState(null),t=m.useRef(null),[R,h]=m.useState(!1),v=n.a(),l=m.useCallback(u=>{const a=s.$getSelection();return x&&s.$isNodeSelection(a)&&(u.preventDefault(),o.update(()=>{a.getNodes().forEach(I=>{n.$isImageNode(I)&&I.remove()})})),!1},[o,x]),c=m.useCallback(u=>{const a=s.$getSelection(),E=D.current;if(x&&s.$isNodeSelection(a)&&a.getNodes().length===1){if(w)return s.$setSelection(null),u.preventDefault(),f.focus(),!0;if(E!==null&&E!==document.activeElement)return u.preventDefault(),E.focus(),!0}return!1},[f,x,w]),P=m.useCallback(u=>t.current===f||D.current===u.target?(s.$setSelection(null),o.update(()=>{y(!0);const a=o.getRootElement();a!==null&&a.focus()}),!0):!1,[f,o,y]),$=m.useCallback(u=>{const a=u;return g?!0:a.target===z.current?(a.shiftKey?y(!x):(j(),y(!0)),!0):!1},[g,x,y,j]),L=m.useCallback(u=>{o.getEditorState().read(()=>{const a=s.$getSelection();u.target.tagName==="IMG"&&s.$isRangeSelection(a)&&a.getNodes().length===1&&o.dispatchCommand(H,u)})},[o]);m.useEffect(()=>{let u=!0;const a=o.getRootElement(),E=n.$(o.registerUpdateListener(({editorState:I})=>{u&&i(I.read(()=>s.$getSelection()))}),o.registerCommand(s.SELECTION_CHANGE_COMMAND,(I,V)=>(t.current=V,!1),s.COMMAND_PRIORITY_LOW),o.registerCommand(s.CLICK_COMMAND,$,s.COMMAND_PRIORITY_LOW),o.registerCommand(H,$,s.COMMAND_PRIORITY_LOW),o.registerCommand(s.DRAGSTART_COMMAND,I=>I.target===z.current?(I.preventDefault(),!0):!1,s.COMMAND_PRIORITY_LOW),o.registerCommand(s.KEY_DELETE_COMMAND,l,s.COMMAND_PRIORITY_LOW),o.registerCommand(s.KEY_BACKSPACE_COMMAND,l,s.COMMAND_PRIORITY_LOW),o.registerCommand(s.KEY_ENTER_COMMAND,c,s.COMMAND_PRIORITY_LOW),o.registerCommand(s.KEY_ESCAPE_COMMAND,P,s.COMMAND_PRIORITY_LOW));return a==null||a.addEventListener("contextmenu",L),()=>{u=!1,E(),a==null||a.removeEventListener("contextmenu",L)}},[j,o,g,x,d,l,c,P,$,L,y]);const T=()=>{o.update(()=>{const u=s.$getNodeByKey(d);n.$isImageNode(u)&&u.setShowCaption(!0)})},Y=(u,a)=>{setTimeout(()=>{O(!1)},200),o.update(()=>{const E=s.$getNodeByKey(d);n.$isImageNode(E)&&E.setWidthAndHeight(u,a)})},k=()=>{O(!0)},G=x&&s.$isNodeSelection(e)&&!g,W=(x||g)&&v;return n.jsxRuntimeExports.jsx(m.Suspense,{fallback:null,children:n.jsxRuntimeExports.jsxs(n.jsxRuntimeExports.Fragment,{children:[n.jsxRuntimeExports.jsx("div",{draggable:G,children:R?n.jsxRuntimeExports.jsx(F,{}):n.jsxRuntimeExports.jsx(U,{className:W?`focused ${s.$isNodeSelection(e)?"draggable":""}`:null,src:p,altText:C,imageRef:z,width:S,height:_,maxWidth:M,onError:()=>h(!0)})}),N&&s.$isNodeSelection(e)&&W&&n.jsxRuntimeExports.jsx(X,{showCaption:w,setShowCaption:T,editor:o,buttonRef:D,imageRef:z,maxWidth:M,onResizeStart:k,onResizeEnd:Y,captionsEnabled:!R&&b})]})})}exports.RIGHT_CLICK_IMAGE_COMMAND=H;exports.default=J;
